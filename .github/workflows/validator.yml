name: AI Sector and Scope Validator
on:
  workflow_dispatch: # Allows you to start it manually with one click
  schedule:
    - cron: '0 0 * * 1' # Runs automatically every Monday at midnight UTC

jobs:
  run-ai-validation:
    runs-on: ubuntu-latest
    timeout-minutes: 360 # Increased timeout for large stock lists

    steps:
      - name: 1. Checkout Repository
        uses: actions/checkout@v4

      - name: 2. Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip' # Speeds up future runs

      - name: 3. Install Dependencies
        run: |
          python -m pip install --upgrade pip
          # Added groq and openpyxl for Excel/AI support
          pip install groq gspread google-generativeai oauth2client pandas requests openpyxl selenium webdriver-manager beautifulsoup4

      - name: 4. Run Sector Fixer Script
        env:
          # Mapping your existing secret names to the script
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GSPREAD_CREDENTIALS: ${{ secrets.GSPREAD_CREDENTIALS }}
        run: python sector_fixer.py

      - name: 5. Handle Errors
        if: failure()
        run: echo "The AI validation job failed. Check logs for Rate Limit or Auth errors."
