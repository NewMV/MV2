name: ðŸš€ Ultra-Fast Stock Scraper (500 Symbols)

on:
  workflow_dispatch:
    inputs:
      start_index:
        description: 'Start Index'
        required: true
        default: '0'
        type: number
      end_index:
        description: 'End Index (500 recommended)'
        required: true
        default: '500'
        type: number
  schedule:
    - cron: '0 2 * * 1-5'  # Mon-Fri 2AM UTC

env:
  START_INDEX: ${{ github.event.inputs.start_index || 0 }}
  END_INDEX: ${{ github.event.inputs.end_index || 500 }}
  MAX_WORKERS: 8

jobs:
  scrape-fast:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install Python Dependencies
      run: |
        pip install --upgrade pip
        pip install gspread oauth2client selenium beautifulsoup4 webdriver-manager
        
    - name: Setup Chrome (Ubuntu 24.04 Fixed)
      run: |
        # Add Google Chrome repo
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
        echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
        
        # Update & install Chrome + deps (Ubuntu 24.04 compatible)
        sudo apt-get update
        sudo apt-get install -y \
          google-chrome-stable \
          xvfb \
          libnss3 \
          libatk-bridge2.0-0 \
          libdrm2 \
          libxkbcommon0 \
          libxcomposite1 \
          libxdamage1 \
          libxrandr2 \
          libgbm1 \
          libasound2t64 \
          fonts-liberation \
          libu2f-udev \
          libvulkan1
        
    - name: Run Fast Scraper
      env:
        GSPREAD_CREDENTIALS: ${{ secrets.GSPREAD_CREDENTIALS }}
        MAX_WORKERS: 8
      run: |
        python run_scraper.py
        
    - name: Upload Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: scraper-results
        path: |
          fast_checkpoint.txt
          *.log
        retention-days: 7
