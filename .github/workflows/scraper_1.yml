name: Test Stock Scraper (2500 Symbols)

on:
  workflow_dispatch: # Allows manual trigger from the Actions tab

jobs:
  scrape_test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Chrome & Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable

      - name: Install Python Libraries
        run: |
          pip install gspread selenium beautifulsoup4 webdriver-manager

      - name: Create Auth Files from Secrets
        run: |
          # Creates the files your Python script expects to see
          echo '${{ secrets.GSPREAD_CREDENTIALS }}' > credentials.json
          echo '${{ secrets.TRADINGVIEW_COOKIES }}' > cookies.json

      - name: Run Scraper (First 200 Symbols)
        env:
          # Mapping your script variables to the test range
          START_INDEX: 1
          END_INDEX: 2500
          SHARD_INDEX: 0
          SHARD_STEP: 1
          CHECKPOINT_FILE: "checkpoint_test.txt"
        run: python run_scraper.py # Ensure this matches your actual filename
